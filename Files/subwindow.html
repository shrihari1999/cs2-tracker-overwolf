<!DOCTYPE html>
<html>
	<head> 
		<link rel="stylesheet" href="css/style.css" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
		<title>Sub window</title>
		<script>
			function dragMove(){
				overwolf.windows.getCurrentWindow(function(result){
					if (result.status=="success"){
						overwolf.windows.dragMove(result.window.id);
					}
				});
			};
			
			function closeWindow(){
				overwolf.windows.getCurrentWindow(function(result){
					if (result.status=="success"){
						overwolf.windows.close(result.window.id);
					}
				});
			};

			function setSteamUserId(){
				let steamUserInputValue = document.getElementById('steam-user-input').value.trim()
				if(!steamUserInputValue){
					closeWindow();
					return
				}

				const steamIdPattern = /^7656119\d{10}$/;
				if (steamIdPattern.test(steamUserInputValue)) {
					localStorage.setItem("steamUserId", steamUserInputValue);
					closeWindow();
					return
				}
				
				const steamUrlPattern = /^https?:\/\/steamcommunity\.com\/profiles\/(7656119\d{10})\/?$/;
				const urlMatch = steamUserInputValue.match(steamUrlPattern);
				if (urlMatch) {
					localStorage.setItem("steamUserId", urlMatch[1]); // Returns just the ID from the URL
					closeWindow();
					return
				}
				
				alert('Invalid Input')
			}
		</script>
	</head>

	<body>
		<div class="content" onmousedown="dragMove();">
			<main class="no-select">
				<h1>Steam Profile URL or ID required</h1>
				<input type="text" id="steam-user-input" placeholder="Paste here..." class="input" />
				<p>Valid inputs:</p>
				<p>76561198300127244</p>
				<p>https://steamcommunity.com/profiles/76561198300127244</p>
				<p>https://steamcommunity.com/profiles/76561198300127244/</p>
				<button class="btn" onclick="setSteamUserId();">Submit</button>
				<button class="btn" onclick="closeWindow();">Cancel</button>
			</main>
		</div>
	</body>
</html>
